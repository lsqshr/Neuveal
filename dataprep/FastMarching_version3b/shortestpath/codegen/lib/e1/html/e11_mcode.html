<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span>  <span class="var type1" id="S2T27U3">EndPoint</span> = e1(<span class="var type1" id="S3T1U6">StartPoint</span>, <span class="var type1" id="S4T1U7">GradientVolume</span>, <span class="var type1" id="S5T1U8">StepSize</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%  E1 is a function which performs one step of the Euler ray tracing</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%   EndPoint = E1(StartPoint, GradientVolume, StepSize);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%    inputs :</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%        StartPoint: 2D or 3D location in vectorfield</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%        GradientVolume: Vectorfield</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%        Stepsize : The stepsize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">%  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   outputs :</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="comment">%        EndPoint : The new location (zero if outside image)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">% Function is written by D.Kroon University of Twente (Oct 2010)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="keyword">if</span>(<span class="mxinfo " id="T3:U5"><span class="mxinfo " id="T2:U6">numel(<span class="var type1" id="S3T1U15">StartPoint</span>)</span>==<span class="mxinfo " id="T2:U8">2</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="comment">%Linear interpolation of current location  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo " id="T4:U9"><span class="var type1" id="S7T4U19">xBas</span>=<span class="mxinfo " id="T4:U11"><span class="mxinfo " id="T4:U12">[<span class="mxinfo " id="T2:U13">0</span> <span class="mxinfo " id="T2:U14">0</span> <span class="mxinfo " id="T2:U15">1</span> <span class="mxinfo " id="T2:U16">1</span>]</span>+<span class="mxinfo " id="T2:U17">floor(<span class="mxinfo " id="T2:U18"><span class="var type1" id="S3T1U30">StartPoint</span>(<span class="mxinfo " id="T2:U20">1</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T4:U21"><span class="var type1" id="S9T4U34">yBas</span>=<span class="mxinfo " id="T4:U23"><span class="mxinfo " id="T4:U24">[<span class="mxinfo " id="T2:U25">0</span> <span class="mxinfo " id="T2:U26">1</span> <span class="mxinfo " id="T2:U27">0</span> <span class="mxinfo " id="T2:U28">1</span>]</span>+<span class="mxinfo " id="T2:U29">floor(<span class="mxinfo " id="T2:U30"><span class="var type1" id="S3T1U45">StartPoint</span>(<span class="mxinfo " id="T2:U32">2</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T2:U33"><span class="var type1" id="S10T2U49">xCom</span>=<span class="mxinfo " id="T2:U35"><span class="mxinfo " id="T2:U36"><span class="var type1" id="S3T1U52">StartPoint</span>(<span class="mxinfo " id="T2:U38">1</span>)</span>-<span class="mxinfo " id="T2:U39">floor(<span class="mxinfo " id="T2:U40"><span class="var type1" id="S3T1U57">StartPoint</span>(<span class="mxinfo " id="T2:U42">1</span>)</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="mxinfo " id="T2:U43"><span class="var type1" id="S11T2U61">yCom</span>=<span class="mxinfo " id="T2:U45"><span class="mxinfo " id="T2:U46"><span class="var type1" id="S3T1U64">StartPoint</span>(<span class="mxinfo " id="T2:U48">2</span>)</span>-<span class="mxinfo " id="T2:U49">floor(<span class="mxinfo " id="T2:U50"><span class="var type1" id="S3T1U69">StartPoint</span>(<span class="mxinfo " id="T2:U52">2</span>)</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    <span class="comment">% Linear interpolation percentages.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo " id="T16:U53"><span class="var type1" id="S12T16U73">perc</span>=<span class="mxinfo " id="T16:U55">[<span class="mxinfo " id="T2:U56">(<span class="mxinfo " id="T2:U57"><span class="mxinfo " id="T2:U58">1</span>-<span class="var type1" id="S10T2U80">xCom</span></span>) * (<span class="mxinfo " id="T2:U60"><span class="mxinfo " id="T2:U61">1</span>-<span class="var type1" id="S11T2U84">yCom</span></span>)</span>;</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo " id="T16:U53"><span class="mxinfo " id="T16:U55">          <span class="mxinfo " id="T2:U63">(<span class="mxinfo " id="T2:U64"><span class="mxinfo " id="T2:U65">1</span>-<span class="var type1" id="S10T2U90">xCom</span></span>) * <span class="var type1" id="S11T2U91">yCom</span></span>    ;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T16:U53"><span class="mxinfo " id="T16:U55">          <span class="mxinfo " id="T2:U68"><span class="var type1" id="S10T2U94">xCom</span>     * (<span class="mxinfo " id="T2:U70"><span class="mxinfo " id="T2:U71">1</span>-<span class="var type1" id="S11T2U98">yCom</span></span>)</span>;</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo " id="T16:U53"><span class="mxinfo " id="T16:U55">          <span class="mxinfo " id="T2:U73"><span class="var type1" id="S10T2U101">xCom</span>     * <span class="var type1" id="S11T2U102">yCom</span></span>    ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="comment">% Split in Gradient Volumes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo " id="T1:U76"><span class="var type1" id="S13T1U105">Gx</span>=<span class="mxinfo " id="T1:U78"><span class="var type1" id="S4T1U107">GradientVolume</span>(<span class="mxinfo " id="T8:U80">:</span>,<span class="mxinfo " id="T28:U81">:</span>,<span class="mxinfo " id="T2:U82">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">    <span class="var type0" id="S14T0U113">Gy</span>=<span class="var type1" id="S4T1U115">GradientVolume</span>(<span class="mxinfo " id="T8:U84">:</span>,<span class="mxinfo " id="T28:U85">:</span>,<span class="mxinfo " id="T2:U86"><span class="message error" id="M1F1C">2</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T4:U87"><span class="var type1" id="S7T4U121">xBas</span>=<span class="mxinfo " id="T4:U89">min(<span class="mxinfo " id="T4:U90">max(<span class="var type1" id="S7T4U126">xBas</span>,<span class="mxinfo " id="T2:U92">1</span>)</span>,<span class="mxinfo " id="T2:U93">size(<span class="var type1" id="S13T1U130">Gx</span>,1)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo " id="T4:U95"><span class="var type1" id="S9T4U134">yBas</span>=<span class="mxinfo " id="T4:U97">min(<span class="mxinfo " id="T4:U98">max(<span class="var type1" id="S9T4U139">yBas</span>,<span class="mxinfo " id="T2:U100">1</span>)</span>,<span class="mxinfo " id="T2:U101">size(<span class="var type1" id="S13T1U143">Gx</span>,2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T16:U103"><span class="var type1" id="S18T16U147">ind</span>=<span class="mxinfo " id="T16:U105">sub2ind(<span class="mxinfo " id="T14:U106">size(<span class="var type1" id="S13T1U152">Gx</span>)</span>,<span class="mxinfo " id="T16:U108"><span class="var type1" id="S7T4U154">xBas</span>(:)</span>,<span class="mxinfo " id="T16:U110"><span class="var type1" id="S9T4U157">yBas</span>(:)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">    <span class="var type0" id="S20T0U161">gradient</span>=[sum(<span class="message error" id="M2F1C"><span class="mxinfo " id="T4:U112"><span class="var type1" id="S13T1U168">Gx</span>(<span class="var type1" id="S18T16U169">ind</span>)</span>.*<span class="var type1" id="S12T16U170">perc</span></span>) sum(<span class="var type0" id="S14T0U175">Gy</span>(<span class="var type0" id="S18T0U176">ind</span>).*<span class="var type0" id="S12T0U177">perc</span>)];</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">    <span class="var type0" id="S20T0U180">gradient</span>=<span class="var type0" id="S20T0U182"><span class="message error" id="M3F1C">gradient</span></span>./(sqrt(sum(<span class="var type0" id="S20T0U190">gradient</span>.^2))+eps);</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">    <span class="comment">% Set a step in the direction of the gradient.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">    <span class="var type0" id="S2T0U196">EndPoint</span>=<span class="mxinfo " id="T29:U116"><span class="var type1" id="S3T1U199">StartPoint</span>(:)</span>-<span class="var type1" id="S5T1U202">StepSize</span>*<span class="var type0" id="S20T0U204"><span class="message error" id="M4F1C">gradient</span></span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo " id="T3:U119"><span class="var type1" id="S24T3U208">check</span>=<span class="mxinfo " id="T3:U121">(<span class="var type0" id="S2T0U215"><span class="message error" id="M5F1C">EndPoint</span></span>(1)&lt;1)||(<span class="var type0" id="S2T0U221"><span class="message error" id="M6F1C">EndPoint</span></span>(2)&lt;1)||(<span class="var type0" id="S2T0U227"><span class="message error" id="M7F1C">EndPoint</span></span>(1)&gt;size(<span class="var type0" id="S13T0U231">Gx</span>,1))||(<span class="var type0" id="S2T0U236"><span class="message error" id="M8F1C">EndPoint</span></span>(2)&gt;size(<span class="var type0" id="S13T0U240">Gx</span>,2))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type1" id="S24T3U245">check</span>), <span class="mxinfo " id="T27:U123"><span class="var type1" id="S2T27U248">EndPoint</span>=<span class="mxinfo " id="T27:U125">[<span class="mxinfo " id="T2:U126">0</span>;<span class="mxinfo " id="T2:U127">0</span>]</span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">    <span class="comment">%Linear interpolation of current location  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo " id="T24:U128"><span class="var type1" id="S7T24U257">xBas</span>=<span class="mxinfo " id="T24:U130"><span class="mxinfo " id="T24:U131">[<span class="mxinfo " id="T2:U132">0</span> <span class="mxinfo " id="T2:U133">0</span> <span class="mxinfo " id="T2:U134">0</span> <span class="mxinfo " id="T2:U135">0</span> <span class="mxinfo " id="T2:U136">1</span> <span class="mxinfo " id="T2:U137">1</span> <span class="mxinfo " id="T2:U138">1</span> <span class="mxinfo " id="T2:U139">1</span>]</span>+<span class="mxinfo " id="T2:U140">floor(<span class="mxinfo " id="T2:U141"><span class="var type1" id="S3T1U272">StartPoint</span>(<span class="mxinfo " id="T2:U143">1</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T24:U144"><span class="var type1" id="S9T24U276">yBas</span>=<span class="mxinfo " id="T24:U146"><span class="mxinfo " id="T24:U147">[<span class="mxinfo " id="T2:U148">0</span> <span class="mxinfo " id="T2:U149">0</span> <span class="mxinfo " id="T2:U150">1</span> <span class="mxinfo " id="T2:U151">1</span> <span class="mxinfo " id="T2:U152">0</span> <span class="mxinfo " id="T2:U153">0</span> <span class="mxinfo " id="T2:U154">1</span> <span class="mxinfo " id="T2:U155">1</span>]</span>+<span class="mxinfo " id="T2:U156">floor(<span class="mxinfo " id="T2:U157"><span class="var type1" id="S3T1U291">StartPoint</span>(<span class="mxinfo " id="T2:U159">2</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo " id="T24:U160"><span class="var type1" id="S25T24U295">zBas</span>=<span class="mxinfo " id="T24:U162"><span class="mxinfo " id="T24:U163">[<span class="mxinfo " id="T2:U164">0</span> <span class="mxinfo " id="T2:U165">1</span> <span class="mxinfo " id="T2:U166">0</span> <span class="mxinfo " id="T2:U167">1</span> <span class="mxinfo " id="T2:U168">0</span> <span class="mxinfo " id="T2:U169">1</span> <span class="mxinfo " id="T2:U170">0</span> <span class="mxinfo " id="T2:U171">1</span>]</span>+<span class="mxinfo " id="T2:U172">floor(<span class="mxinfo " id="T2:U173"><span class="var type1" id="S3T1U310">StartPoint</span>(<span class="mxinfo " id="T2:U175">3</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T2:U176"><span class="var type1" id="S10T2U314">xCom</span>=<span class="mxinfo " id="T2:U178"><span class="mxinfo " id="T2:U179"><span class="var type1" id="S3T1U317">StartPoint</span>(<span class="mxinfo " id="T2:U181">1</span>)</span>-<span class="mxinfo " id="T2:U182">floor(<span class="mxinfo " id="T2:U183"><span class="var type1" id="S3T1U322">StartPoint</span>(<span class="mxinfo " id="T2:U185">1</span>)</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T2:U186"><span class="var type1" id="S11T2U326">yCom</span>=<span class="mxinfo " id="T2:U188"><span class="mxinfo " id="T2:U189"><span class="var type1" id="S3T1U329">StartPoint</span>(<span class="mxinfo " id="T2:U191">2</span>)</span>-<span class="mxinfo " id="T2:U192">floor(<span class="mxinfo " id="T2:U193"><span class="var type1" id="S3T1U334">StartPoint</span>(<span class="mxinfo " id="T2:U195">2</span>)</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">    <span class="mxinfo " id="T2:U196"><span class="var type1" id="S26T2U338">zCom</span>=<span class="mxinfo " id="T2:U198"><span class="mxinfo " id="T2:U199"><span class="var type1" id="S3T1U341">StartPoint</span>(<span class="mxinfo " id="T2:U201">3</span>)</span>-<span class="mxinfo " id="T2:U202">floor(<span class="mxinfo " id="T2:U203"><span class="var type1" id="S3T1U346">StartPoint</span>(<span class="mxinfo " id="T2:U205">3</span>)</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">    <span class="comment">% Linear interpolation percentages.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">    <span class="mxinfo " id="T25:U206"><span class="var type1" id="S12T25U350">perc</span>=<span class="mxinfo " id="T25:U208">[<span class="mxinfo " id="T2:U209"><span class="mxinfo " id="T2:U210">(<span class="mxinfo " id="T2:U211"><span class="mxinfo " id="T2:U212">1</span>-<span class="var type1" id="S10T2U358">xCom</span></span>) * (<span class="mxinfo " id="T2:U214"><span class="mxinfo " id="T2:U215">1</span>-<span class="var type1" id="S11T2U362">yCom</span></span>)</span> * (<span class="mxinfo " id="T2:U217"><span class="mxinfo " id="T2:U218">1</span>-<span class="var type1" id="S26T2U366">zCom</span></span>)</span>;</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line"><span class="mxinfo " id="T25:U206"><span class="mxinfo " id="T25:U208">          <span class="mxinfo " id="T2:U220"><span class="mxinfo " id="T2:U221">(<span class="mxinfo " id="T2:U222"><span class="mxinfo " id="T2:U223">1</span>-<span class="var type1" id="S10T2U373">xCom</span></span>) * (<span class="mxinfo " id="T2:U225"><span class="mxinfo " id="T2:U226">1</span>-<span class="var type1" id="S11T2U377">yCom</span></span>)</span> * <span class="var type1" id="S26T2U378">zCom</span></span>;</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line"><span class="mxinfo " id="T25:U206"><span class="mxinfo " id="T25:U208">          <span class="mxinfo " id="T2:U229"><span class="mxinfo " id="T2:U230">(<span class="mxinfo " id="T2:U231"><span class="mxinfo " id="T2:U232">1</span>-<span class="var type1" id="S10T2U385">xCom</span></span>) * <span class="var type1" id="S11T2U386">yCom</span></span>     * (<span class="mxinfo " id="T2:U235"><span class="mxinfo " id="T2:U236">1</span>-<span class="var type1" id="S26T2U390">zCom</span></span>)</span>;</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line"><span class="mxinfo " id="T25:U206"><span class="mxinfo " id="T25:U208">          <span class="mxinfo " id="T2:U238"><span class="mxinfo " id="T2:U239">(<span class="mxinfo " id="T2:U240"><span class="mxinfo " id="T2:U241">1</span>-<span class="var type1" id="S10T2U397">xCom</span></span>) * <span class="var type1" id="S11T2U398">yCom</span></span>     * <span class="var type1" id="S26T2U399">zCom</span></span>;</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line"><span class="mxinfo " id="T25:U206"><span class="mxinfo " id="T25:U208">          <span class="mxinfo " id="T2:U245"><span class="mxinfo " id="T2:U246"><span class="var type1" id="S10T2U403">xCom</span>     * (<span class="mxinfo " id="T2:U248"><span class="mxinfo " id="T2:U249">1</span>-<span class="var type1" id="S11T2U407">yCom</span></span>)</span> * (<span class="mxinfo " id="T2:U251"><span class="mxinfo " id="T2:U252">1</span>-<span class="var type1" id="S26T2U411">zCom</span></span>)</span>;</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"><span class="mxinfo " id="T25:U206"><span class="mxinfo " id="T25:U208">          <span class="mxinfo " id="T2:U254"><span class="mxinfo " id="T2:U255"><span class="var type1" id="S10T2U415">xCom</span>     * (<span class="mxinfo " id="T2:U257"><span class="mxinfo " id="T2:U258">1</span>-<span class="var type1" id="S11T2U419">yCom</span></span>)</span> * <span class="var type1" id="S26T2U420">zCom</span></span>;</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"><span class="mxinfo " id="T25:U206"><span class="mxinfo " id="T25:U208">          <span class="mxinfo " id="T2:U261"><span class="mxinfo " id="T2:U262"><span class="var type1" id="S10T2U424">xCom</span>     * <span class="var type1" id="S11T2U425">yCom</span></span>     * (<span class="mxinfo " id="T2:U265"><span class="mxinfo " id="T2:U266">1</span>-<span class="var type1" id="S26T2U429">zCom</span></span>)</span>;</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line"><span class="mxinfo " id="T25:U206"><span class="mxinfo " id="T25:U208">          <span class="mxinfo " id="T2:U268"><span class="mxinfo " id="T2:U269"><span class="var type1" id="S10T2U433">xCom</span>     * <span class="var type1" id="S11T2U434">yCom</span></span>     * <span class="var type1" id="S26T2U435">zCom</span></span>;]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">    <span class="comment">% Split in Gradient Volumes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line">    <span class="mxinfo " id="T1:U273"><span class="var type1" id="S13T1U438">Gx</span>=<span class="mxinfo " id="T1:U275"><span class="var type1" id="S4T1U440">GradientVolume</span>(<span class="mxinfo " id="T8:U277">:</span>,<span class="mxinfo " id="T28:U278">:</span>,<span class="mxinfo " id="T8:U279">:</span>,<span class="mxinfo " id="T2:U280">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line">    <span class="var type0" id="S14T0U447">Gy</span>=<span class="var type1" id="S4T1U449">GradientVolume</span>(<span class="mxinfo " id="T8:U282">:</span>,<span class="mxinfo " id="T28:U283">:</span>,<span class="mxinfo " id="T8:U284">:</span>,<span class="mxinfo " id="T2:U285"><span class="message error" id="M9F1C">2</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line">    <span class="var type0" id="S27T0U456">Gz</span>=<span class="var type1" id="S4T1U458">GradientVolume</span>(<span class="mxinfo " id="T8:U287">:</span>,<span class="mxinfo " id="T28:U288">:</span>,<span class="mxinfo " id="T8:U289">:</span>,<span class="mxinfo " id="T2:U290"><span class="message error" id="M10F1C">3</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line">    <span class="mxinfo " id="T24:U291"><span class="var type1" id="S7T24U465">xBas</span>=<span class="mxinfo " id="T24:U293">min(<span class="mxinfo " id="T24:U294">max(<span class="var type1" id="S7T24U470">xBas</span>,<span class="mxinfo " id="T2:U296">1</span>)</span>,<span class="mxinfo " id="T2:U297">size(<span class="var type1" id="S13T1U474">Gx</span>,1)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line">    <span class="mxinfo " id="T24:U299"><span class="var type1" id="S9T24U478">yBas</span>=<span class="mxinfo " id="T24:U301">min(<span class="mxinfo " id="T24:U302">max(<span class="var type1" id="S9T24U483">yBas</span>,<span class="mxinfo " id="T2:U304">1</span>)</span>,<span class="mxinfo " id="T2:U305">size(<span class="var type1" id="S13T1U487">Gx</span>,2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line">    <span class="mxinfo " id="T24:U307"><span class="var type1" id="S25T24U491">zBas</span>=<span class="mxinfo " id="T24:U309">min(<span class="mxinfo " id="T24:U310">max(<span class="var type1" id="S25T24U496">zBas</span>,<span class="mxinfo " id="T2:U312">1</span>)</span>,<span class="mxinfo " id="T2:U313">size(<span class="var type1" id="S13T1U500">Gx</span>,3)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line">    <span class="mxinfo " id="T25:U315"><span class="var type1" id="S18T25U504">ind</span>=<span class="mxinfo " id="T25:U317">sub2ind(<span class="mxinfo " id="T14:U318">size(<span class="var type1" id="S13T1U509">Gx</span>)</span>,<span class="mxinfo " id="T25:U320"><span class="var type1" id="S7T24U511">xBas</span>(:)</span>,<span class="mxinfo " id="T25:U322"><span class="var type1" id="S9T24U514">yBas</span>(:)</span>,<span class="mxinfo " id="T25:U324"><span class="var type1" id="S25T24U517">zBas</span>(:)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73">73</a></span><span class="line">    <span class="var type0" id="S20T0U521">gradient</span>=[sum(<span class="message error" id="M11F1C"><span class="mxinfo " id="T24:U326"><span class="var type1" id="S13T1U528">Gx</span>(<span class="var type1" id="S18T25U529">ind</span>)</span>.*<span class="var type1" id="S12T25U530">perc</span></span>) sum(<span class="var type0" id="S14T0U535">Gy</span>(<span class="var type0" id="S18T0U536">ind</span>).*<span class="var type0" id="S12T0U537">perc</span>) sum(<span class="var type0" id="S27T0U542">Gz</span>(<span class="var type0" id="S18T0U543">ind</span>).*<span class="var type0" id="S12T0U544">perc</span>)];</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74">74</a></span><span class="line">    <span class="var type0" id="S20T0U547">gradient</span>=<span class="var type0" id="S20T0U549"><span class="message error" id="M12F1C">gradient</span></span>./(sqrt(sum(<span class="var type0" id="S20T0U557">gradient</span>.^2))+eps);</span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75">75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76">76</a></span><span class="line">    <span class="comment">% Set a step in the direction of the gradient.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77">77</a></span><span class="line">    <span class="var type0" id="S2T0U563">EndPoint</span>=<span class="var type1" id="S3T1U565">StartPoint</span>-<span class="var type1" id="S5T1U567">StepSize</span>*<span class="var type0" id="S20T0U569"><span class="message error" id="M13F1C">gradient</span></span>(:);</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78">78</a></span><span class="line">    <span class="mxinfo " id="T3:U332"><span class="var type1" id="S24T3U573">check</span>=<span class="mxinfo " id="T3:U334">(<span class="mxinfo " id="T3:U335"><span class="mxinfo " id="T2:U336"><span class="var type1" id="S2T27U582">EndPoint</span>(1)</span>&lt;<span class="mxinfo " id="T2:U338">1</span></span>)||(<span class="mxinfo " id="T3:U339"><span class="mxinfo " id="T2:U340"><span class="var type1" id="S2T27U588">EndPoint</span>(2)</span>&lt;<span class="mxinfo " id="T2:U342">1</span></span>)||(<span class="var type1" id="S2T27U594">EndPoint</span>(<span class="mxinfo " id="T2:U344"><span class="message error" id="M14F1C">3</span></span>)&lt;1)||(<span class="mxinfo " id="T3:U345"><span class="mxinfo " id="T2:U346"><span class="var type1" id="S2T27U600">EndPoint</span>(1)</span>&gt;<span class="mxinfo " id="T2:U348">size(<span class="var type1" id="S13T1U604">Gx</span>,1)</span></span>)||(<span class="mxinfo " id="T3:U350"><span class="mxinfo " id="T2:U351"><span class="var type1" id="S2T27U609">EndPoint</span>(2)</span>&gt;<span class="mxinfo " id="T2:U353">size(<span class="var type1" id="S13T1U613">Gx</span>,2)</span></span>)||(<span class="var type1" id="S2T27U618">EndPoint</span>(<span class="mxinfo " id="T2:U356"><span class="message error" id="M15F1C">3</span></span>)&gt;size(<span class="var type0" id="S13T0U622">Gx</span>,3))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79">79</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type1" id="S24T3U627">check</span>), <span class="mxinfo " id="T27:U358"><span class="var type1" id="S2T27U630"><span class="message error" id="M16F1C">EndPoint</span></span></span>=<span class="mxinfo " id="T30:U359">[<span class="mxinfo " id="T2:U360">0</span>;<span class="mxinfo " id="T2:U361">0</span>;<span class="mxinfo " id="T2:U362">0</span>]</span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80">80</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
